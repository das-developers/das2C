<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>das2C: Network</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="das2logo-32.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">das2C
   </div>
   <div id="projectbrief">das2 core C utilities</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Network</div>  </div>
</div><!--header-->
<div class="contents">

<p>HTTP and HTTPs network operations and authentication.  
<a href="#details">More...</a></p>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>HTTP and HTTPs network operations and authentication. </p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structdas__credential__t.html">das_credential_t</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">A single credential.  <a href="structdas__credential__t.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structdas__credmngr.html">das_credmngr</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Credentials manager Handles a list of login credentials and supplies these as needed for network operations.  <a href="structdas__credmngr.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structdas__url.html">das_url</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">A parsed URL structure.  <a href="structdas__url.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structdas__http__response__t.html">das_http_response_t</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Encapsulates the status of a HTTP resource request.  <a href="structdas__http__response__t.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:gae2f09c8bff1c61b5d4b67f042d3f431d"><td class="memItemLeft" align="right" valign="top">typedef bool(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__network.html#gae2f09c8bff1c61b5d4b67f042d3f431d">das_prompt</a>) (const char *sServer, const char *sRealm, const char *sDataset, const char *sMessage, char *sUser, char *sPassword)</td></tr>
<tr class="memdesc:gae2f09c8bff1c61b5d4b67f042d3f431d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function signature for swapping out the user-prompt for credentials acquisition.  <a href="group__network.html#gae2f09c8bff1c61b5d4b67f042d3f431d">More...</a><br /></td></tr>
<tr class="separator:gae2f09c8bff1c61b5d4b67f042d3f431d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gaa68401058739466e989491dde492aaf3"><td class="memItemLeft" align="right" valign="top">DAS_API char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__network.html#gaa68401058739466e989491dde492aaf3">das_ssl_getErr</a> (const void *vpSsl, int nRet)</td></tr>
<tr class="memdesc:gaa68401058739466e989491dde492aaf3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get a new string allocated on the heap explaining an SSL error or NULL in nRet == 0.  <a href="group__network.html#gaa68401058739466e989491dde492aaf3">More...</a><br /></td></tr>
<tr class="separator:gaa68401058739466e989491dde492aaf3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga35666aa19a4c66677a56f9ffd8ce9462"><td class="memItemLeft" align="right" valign="top">DAS_API bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__network.html#ga35666aa19a4c66677a56f9ffd8ce9462">das_http_getBody</a> (const char *sUrl, const char *sAgent, DasCredMngr *pMgr, DasHttpResp *pRes, float rConSec)</td></tr>
<tr class="memdesc:ga35666aa19a4c66677a56f9ffd8ce9462"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get a socket positioned at the start of a remote resource.  <a href="group__network.html#ga35666aa19a4c66677a56f9ffd8ce9462">More...</a><br /></td></tr>
<tr class="separator:ga35666aa19a4c66677a56f9ffd8ce9462"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga389511221eee35d18b7f032f24e319bb"><td class="memItemLeft" align="right" valign="top">DAS_API DasAry *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__network.html#ga389511221eee35d18b7f032f24e319bb">das_http_readUrl</a> (const char *sUrl, const char *sAgent, DasCredMngr *pMgr, DasHttpResp *pRes, int64_t nLimit, float rConSec)</td></tr>
<tr class="memdesc:ga389511221eee35d18b7f032f24e319bb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read all the bytes for a URL into a byte array.  <a href="group__network.html#ga389511221eee35d18b7f032f24e319bb">More...</a><br /></td></tr>
<tr class="separator:ga389511221eee35d18b7f032f24e319bb"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Typedef Documentation</h2>
<a id="gae2f09c8bff1c61b5d4b67f042d3f431d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gae2f09c8bff1c61b5d4b67f042d3f431d">&#9670;&nbsp;</a></span>das_prompt</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef bool(* das_prompt) (const char *sServer, const char *sRealm, const char *sDataset, const char *sMessage, char *sUser, char *sPassword)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function signature for swapping out the user-prompt for credentials acquisition. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sServer</td><td>The server name </td></tr>
    <tr><td class="paramname">sRealm</td><td>The authorization realm on this server, can be same as the dataset </td></tr>
    <tr><td class="paramname">sDataset</td><td>The name of the dataset on this server </td></tr>
    <tr><td class="paramname">sMessage</td><td>An additional message that may be supplied, such as "The user name cannot contain a colon, ':', character" </td></tr>
    <tr><td class="paramname">sUser</td><td>a pointer to 128 bytes of storage to hold the username </td></tr>
    <tr><td class="paramname">sPassword</td><td>a pointer to 128 bytes of storage to hold the password </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if the user entered a user name and password (even empty ones) and false if the prompt was canceled. </dd></dl>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="gaa68401058739466e989491dde492aaf3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaa68401058739466e989491dde492aaf3">&#9670;&nbsp;</a></span>das_ssl_getErr()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">DAS_API char* das_ssl_getErr </td>
          <td>(</td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>vpSsl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nRet</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get a new string allocated on the heap explaining an SSL error or NULL in nRet == 0. </p>
<p>To prevent memory leaks, caller must free string if return is NON null. </p>

</div>
</div>
<a id="ga35666aa19a4c66677a56f9ffd8ce9462"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga35666aa19a4c66677a56f9ffd8ce9462">&#9670;&nbsp;</a></span>das_http_getBody()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">DAS_API bool das_http_getBody </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>sUrl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>sAgent</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DasCredMngr *&#160;</td>
          <td class="paramname"><em>pMgr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DasHttpResp *&#160;</td>
          <td class="paramname"><em>pRes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>rConSec</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get a socket positioned at the start of a remote resource. </p>
<p>This function makes a connection to a remote HTTP or HTTPS server, reads through the HTTP headers and then passes the socket descriptor and possibly an SSL connection object back to the caller.</p>
<p>If a redirect response is detected, the initial connection is dropped and a new one is made to the indicated location.</p>
<p>If the GET request fails due to needing authentication, the given credential manager is consulted for a username and password. If one is present that matches the URL path (and optionally the dataset, see below) then it is used, otherwise the manager's getPassword function is called and another attempt is made. The cycle continues until the connection succeeds or getPassword fails.</p>
<p>Meta details about the connection including the body mime-type and any error messages are stored in the sHeaders element of the DasHttpResp structure.</p>
<p>It is the caller's responsibility to call shutdown for the provided socket descriptor or the SSL connection when it is finished reading the message body.</p>
<p><b>Das2 Note:</b> Since das2 servers can request different authentication for each dataset, the get string is inpected for the 'server=dataset' pair. If found the URL saved in the credentials manager will be <a href="http://SERVER/path?dataset=DATASET">http://SERVER/path?dataset=DATASET</a> instead of just <a href="http://SERVER/path">http://SERVER/path</a>. This a bit of a hack and a better solution should be found in the future.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sUrl</td><td>The location to connect to, will be URL encoded before transmission</td></tr>
    <tr><td class="paramname">sAgent</td><td>The user agent string you wish to send to the server. If NULL then the string "libdas2/2.3" is sent.</td></tr>
    <tr><td class="paramname">pMgr</td><td>A credentials manager object to consult if a password is requested. May be set to NULL to indicate that only public items may be requested.</td></tr>
    <tr><td class="paramname">pRes</td><td>A pointer to a response object that will be filled in with the result of the connection attempt. This contains the headers error messages etc.</td></tr>
    <tr><td class="paramname">rConSec</td><td>If &gt; 0.0 this is the floating point number of seconds to wait on a connection before giving up. If 0.0 or less then operating system defaults are used. Typical OS default is about five minutes. This value only affects the initial connection timeout and not the wait time for data to appear.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if pRes-&gt;nSockFd, or pRes-&gt;pSsl is ready for reading, false otherwise. </dd></dl>

</div>
</div>
<a id="ga389511221eee35d18b7f032f24e319bb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga389511221eee35d18b7f032f24e319bb">&#9670;&nbsp;</a></span>das_http_readUrl()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">DAS_API DasAry* das_http_readUrl </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>sUrl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>sAgent</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DasCredMngr *&#160;</td>
          <td class="paramname"><em>pMgr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DasHttpResp *&#160;</td>
          <td class="paramname"><em>pRes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int64_t&#160;</td>
          <td class="paramname"><em>nLimit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>rConSec</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read all the bytes for a URL into a byte array. </p>
<p>Since network operations are presumed to fail often, all errors are logged using the functions in <a class="el" href="log_8h.html">log.h</a>, das_error is not called unless a memory allocation error occurs.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sUrl</td><td>- The URL to read, may be http or https contain alternate port numbers etc.</td></tr>
    <tr><td class="paramname">sAgent</td><td>The user agent string you wish to send to the server. If NULL then the string "libdas2/2.3" is sent.</td></tr>
    <tr><td class="paramname">pMgr</td><td>A credentials manager object to consult if a password is requested. May be set to NULL to indicate that only public items may be requested.</td></tr>
    <tr><td class="paramname">pRes</td><td>A pointer to a http response object that will hold the headers from the final destination. Due to redirects the URL in the response may not be the same as the initial one provided in sUrl</td></tr>
    <tr><td class="paramname">nLimit</td><td>An upper limit on the number of bytes to download, if less than 1 then limit checks are disabled and download will continue until complete, a socket error occurs, or no additional memory can be allocated. The actual amount of data read maybe upto 32K - 1 bytes more than the given limit.</td></tr>
  </table>
  </dd>
</dl>
<ul>
<li><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">rConSec</td><td>If &gt; 0.0 this is the floating point number of seconds to wait on a connection before giving up. If 0.0 or less then operating system defaults are used. Typical OS default is about five minutes. This value only affects the initial connection timeout and not the wait time for data to appear.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A 1-dimensional DasAry with element type vtByte allocated on the heap, or NULL if the download failed. <br  />
</dd></dl>
The ID member of the allocated array will correspond to the last component of the URL path, not including any fragments, or if accessing the root of a server, then the host name will be used. </li>
</ul>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
