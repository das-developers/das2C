<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>das2C: das_array Struct Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="das2logo-32.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">das2C
   </div>
   <div id="projectbrief">das2 core C utilities</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">das_array Struct Reference<div class="ingroups"><a class="el" href="group__datasets.html">Datasets</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="array_8h_source.html">das2/array.h</a>&gt;</code></p>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Dynamic recursive ragged arrays. </p>
<p>This class maps any number of indices, (i,j,k...) to elements stored into a continuous array. Any or all particular indexes of the array may be ragged if desired, though typically for fixed record size data streams, only the first index has an arbitrary length.</p>
<p>The backing buffers for the array grow as needed when new elements are appended. Individual elements may be arbitrary composite types, though extra capabilites are provided for a handful of known types.</p>
<p>Handling ragged data comes at a cost in that the length of each continuous run of elements must also be stored in an ancillary array since address strides are not necessarily constant. This cost is 8 to 16 bytes times the size of all indexes, except the last. For example, an array of shape (10,100,40) would use 10*100*16 extra bytes compared to a simple strideable array, though this is typically much smaller than the 10*100*40*element_size bytes used by the primary data buffer.</p>
<p>Handling ragged data also comes at a cost in terms of potential cache misses. For example to lookup a value in a rank 3 array requires accessing three dynamically allocated buffers. One for each dimension of the array. The first two are offset value buffers, the last is the actual data buffer.</p>
<p>Automatically switching to more efficent strided index calculations in cases where all records are of a constant size has yet to be implemented, though the DasAry_stride() function can be used to stride across the raw data buffer efficently if desired.</p>
<div class="fragment"><div class="line"><span class="comment">// For this example, assume the file below consists of big endian floats</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* my_file = <span class="stringliteral">&quot;my_big_endian_datafile.dat&quot;</span>;</div>
<div class="line">FILE* in_file = fopen(my_file, <span class="stringliteral">&quot;rb&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// The following Rank 2 array is initially 0 records long and has</span></div>
<div class="line"><span class="comment">// 152 values per record.  Thus it starts as a 0 by 152 array</span></div>
<div class="line">Array* pAry = new_Array(<span class="stringliteral">&quot;amplitudes&quot;</span>, etFloat, 0, NULL, RANK_2(0, 152));</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Set byte order for input values.  This will trigger swapping if host</span></div>
<div class="line"><span class="comment">// byte order is different from input order.  Note that this only works</span></div>
<div class="line"><span class="comment">// for the types in the element_type enumeration.  For unknown types you&#39;ll</span></div>
<div class="line"><span class="comment">// have to do your own byte swapping.</span></div>
<div class="line">DasAry_inputBO(pAry, DAS2ARY_BIG_ENDIAN);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Read values into the array</span></div>
<div class="line"><span class="keywordtype">float</span> buf[152] = {0.0f};</div>
<div class="line"><span class="keywordflow">while</span>(fread(buf, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>), 152, in_file) == 152)</div>
<div class="line">  DasAry_append(pAry, buf, 152);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Get the shape of the first index.</span></div>
<div class="line">printf(<span class="stringliteral">&quot;%d records read from %s\n&quot;</span>, DasAry_lengthIn(pAry, DIM0), my_file);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Print the values in the array, loop below works with ragged arrays and</span></div>
<div class="line"><span class="comment">// reduces function call overhead by accessing a full record at a time</span></div>
<div class="line"><span class="keywordtype">float</span>* pVals;</div>
<div class="line"><span class="keywordtype">size_t</span> uVals;</div>
<div class="line"><span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 0; i &lt; DasAry_lengthIn(pAry, DIM0); ++i){</div>
<div class="line">   pVals = <a class="code" href="array_8h.html#a8ad05dbecc66a8f437a62c1d986bf318">DasAry_getFloatsIn</a>(pAry, DIM1_AT(i), &amp;uVals);</div>
<div class="line">   <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> j = 0; j &lt; uVals; ++j){</div>
<div class="line">     <span class="keywordflow">if</span>( j &gt; 0) printf(<span class="stringliteral">&quot;, &quot;</span>);</div>
<div class="line">     printf(<span class="stringliteral">&quot;%.4e&quot;</span>, pVals[j]);</div>
<div class="line">   }</div>
<div class="line">   printf(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --> </div><hr/>The documentation for this struct was generated from the following file:<ul>
<li>das2/<a class="el" href="array_8h_source.html">array.h</a></li>
</ul>
</div><!-- contents -->
<div class="ttc" id="aarray_8h_html_a8ad05dbecc66a8f437a62c1d986bf318"><div class="ttname"><a href="array_8h.html#a8ad05dbecc66a8f437a62c1d986bf318">DasAry_getFloatsIn</a></div><div class="ttdeci">#define DasAry_getFloatsIn(T,...)</div><div class="ttdoc">A wrapper around DasAry_getIn that casts the output and preforms type checking.</div><div class="ttdef"><b>Definition:</b> array.h:835</div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
