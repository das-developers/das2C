<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>das2C: DFT</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="das2logo-32.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">das2C
   </div>
   <div id="projectbrief">das2 core C utilities</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">DFT</div>  </div>
</div><!--header-->
<div class="contents">

<p>Discrete Fourier transforms and power spectral density estimation.  
<a href="#details">More...</a></p>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Discrete Fourier transforms and power spectral density estimation. </p>
<p>This module provides an amplitude preserving 1-D Fourier transform and power preserving Power Spectral Density estimator. One key concept for this module is FFT plans can not be created and destroyed while transforms are running. On Linux the FFTW3 library is used to provide fast transform capability, the library to use for Windows is yet to be determined. <br  />
</p>
<p>On linux if the file /etc/fftw/wisdom exists it will be loaded during the call to <a class="el" href="util_8h.html#ab73de5e20047e7e8f6d6ec8416ea1bdb" title="Initialize any global structures in the Das2 library.">das_init()</a>. Pre-planning FFT operations can significantly increase the speed of new_DftPlan() calls</p>
<p>The following example uses the pthread library to demonstrate running four simultaneous transforms.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define SEC_IN_DAY 86400</span></div>
<div class="line"><span class="preprocessor">#define FREQUENCIES (SEC_IN_DAY/2 + 1)</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// I/O structure for worker threads</span></div>
<div class="line"><span class="keyword">struct </span>thread_data {</div>
<div class="line">  <a class="code" href="group__DFT.html#gaac4638b81c23c4e1d41ef753d65373a9">DftPlan</a>* pPlan;</div>
<div class="line">  <span class="keywordtype">double</span>* pInput;</div>
<div class="line">  <span class="keywordtype">double</span>* pOutput;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span>* doTransform(<span class="keywordtype">void</span>* vpThreadData){</div>
<div class="line">  <span class="keyword">struct </span>thread_data* pTd = (<span class="keyword">struct </span>thread_data*)vpThreadData;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// DFT objects should be created on a per-thread basis</span></div>
<div class="line">  Das2Dft* pDft = new_Dft(pTd-&gt;pPlan, <span class="stringliteral">&quot;HANN&quot;</span>);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Run the transform saving the complex output to DFT obj memory</span></div>
<div class="line">  Dft_calculate(pDft, pTd-&gt;pInput, NULL);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Copy magnitude out to the location designated be the main thread</span></div>
<div class="line">  <span class="keywordtype">size_t</span>* uLen = 0;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span>* pMag = Dft_getMagnitude(pDft, &amp;uLen);</div>
<div class="line">  assert(uLen == FREQUENCIES);</div>
<div class="line">  memcpy(pTd-&gt;pOutput, pMag, uLen*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"> </div>
<div class="line">  del_Dft(pDft);</div>
<div class="line">  <span class="keywordflow">return</span> NULL;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">main(){</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Initialize libdas2</span></div>
<div class="line">  <a class="code" href="util_8h.html#ab73de5e20047e7e8f6d6ec8416ea1bdb">das_init</a>(0, 0, DAS_LL_NOTICE, NULL);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span>* timeseries = (<span class="keywordtype">double</span>*) calloc(SEC_IN_DAY*4, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Do something to fill time array ...</span></div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span>* spectra = (<span class="keywordtype">double</span>*) calloc(FREQUENCIES*4, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Make a plan for calculating the DFTs</span></div>
<div class="line">  <a class="code" href="group__DFT.html#gaac4638b81c23c4e1d41ef753d65373a9">DftPlan</a>* pPlan = new_DftPlan(SEC_IN_DAY, DAS2DFT_FORWARD, <span class="stringliteral">&quot;my_program&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Now calculate 4 spectra at the same time</span></div>
<div class="line">  <span class="keyword">struct </span>thread_data[4] = {NULL};</div>
<div class="line">  pthread_t threads[4];</div>
<div class="line">  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; 4; ++i){</div>
<div class="line">     thread_data[i].pPlan = pPlan;</div>
<div class="line">     thread_data[i].pInput = timeseries + SEC_IN_DAY*i;</div>
<div class="line">     thread_data[i].pOutput = spectra + FREQUENCIES*i;</div>
<div class="line">     pthread_create(threads+i, NULL, doTransform, thread_data+i);</div>
<div class="line">  }</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; 4; ++i) pthread_join(threads + i);</div>
<div class="line">  </div>
<div class="line">  del_DftPlan(pPlan);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Do something with all 4 spectra ...</span></div>
<div class="line">  </div>
<div class="line">}</div>
</div><!-- fragment --> <table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structdas__dft__t.html">das_dft_t</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">An amplitude preserving Discrete Fourier Transform converter.  <a href="structdas__dft__t.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structdas__psd__t.html">das_psd_t</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">A power spectral density estimator (periodogram)  <a href="structdas__psd__t.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:gaac4638b81c23c4e1d41ef753d65373a9"><td class="memItemLeft" align="right" valign="top"><a id="gaac4638b81c23c4e1d41ef753d65373a9"></a>
typedef struct dft_plan&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__DFT.html#gaac4638b81c23c4e1d41ef753d65373a9">DftPlan</a></td></tr>
<tr class="memdesc:gaac4638b81c23c4e1d41ef753d65373a9"><td class="mdescLeft">&#160;</td><td class="mdescRight">An structure containing a set of global planning data for DFTs to be preformed. <br /></td></tr>
<tr class="separator:gaac4638b81c23c4e1d41ef753d65373a9"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga46f93636ffe07628068596fe879f2623"><td class="memItemLeft" align="right" valign="top">const DAS_API double *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__DFT.html#ga46f93636ffe07628068596fe879f2623">Dft_getReal</a> (Das2Dft *pThis, size_t *pLen)</td></tr>
<tr class="memdesc:ga46f93636ffe07628068596fe879f2623"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the real component after a calculation.  <a href="group__DFT.html#ga46f93636ffe07628068596fe879f2623">More...</a><br /></td></tr>
<tr class="separator:ga46f93636ffe07628068596fe879f2623"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="ga46f93636ffe07628068596fe879f2623"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga46f93636ffe07628068596fe879f2623">&#9670;&nbsp;</a></span>Dft_getReal()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const DAS_API double* Dft_getReal </td>
          <td>(</td>
          <td class="paramtype">Das2Dft *&#160;</td>
          <td class="paramname"><em>pThis</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>pLen</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return the real component after a calculation. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pThis</td><td></td></tr>
    <tr><td class="paramname">pLen</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

</div>
</div>
</div><!-- contents -->
<div class="ttc" id="autil_8h_html_ab73de5e20047e7e8f6d6ec8416ea1bdb"><div class="ttname"><a href="util_8h.html#ab73de5e20047e7e8f6d6ec8416ea1bdb">das_init</a></div><div class="ttdeci">DAS_API void das_init(const char *sProgName, int nErrDis, int nErrBufSz, int nLevel, das_log_handler_t logfunc)</div><div class="ttdoc">Initialize any global structures in the Das2 library.</div></div>
<div class="ttc" id="agroup__DFT_html_gaac4638b81c23c4e1d41ef753d65373a9"><div class="ttname"><a href="group__DFT.html#gaac4638b81c23c4e1d41ef753d65373a9">DftPlan</a></div><div class="ttdeci">struct dft_plan DftPlan</div><div class="ttdoc">An structure containing a set of global planning data for DFTs to be preformed.</div><div class="ttdef"><b>Definition:</b> dft.h:126</div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
