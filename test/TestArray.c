/** @file TestArrays.c Unit tests for dynamic array handling */

/* Author: Chris Piker <chris-piker@uiowa.edu>
 * 
 * This file contains test and example code and is meant to explain an
 * interface.
 * 
 * As United States courts have ruled that interfaces cannot be copyrighted,
 * the code in this individual source file, TestArrays.c, is placed into the
 * public domain and may be displayed, incorporated or otherwise re-used without
 * restriction.  It is offered to the public without any without any warranty
 * including even the implied warranty of merchantability or fitness for a
 * particular purpose.
 */

#define _POSIX_C_SOURCE 200112L

#include <stdio.h>
#include <stdlib.h>
#include <math.h>
#include <string.h>

#include <das2/core.h>

const char* lTime[] = {
	"1997-05-07T15:00:16.207",
	"1997-05-07T15:00:34.874",
	"1997-05-07T15:00:53.541",
	"1997-05-07T15:01:12.207",
	"1997-05-07T15:01:30.874",
	"1997-05-07T15:01:49.541",
	"1997-05-07T15:02:08.207",
	"1997-05-07T15:02:26.874",
	"1997-05-07T15:02:45.541",
	"1997-05-07T15:03:04.207"
};

double lFreq[] = {
	5.620e+00, 1.000e+01, 1.780e+01, 3.110e+01, 4.213e+01, 4.538e+01, 4.888e+01,
   5.265e+01, 5.671e+01, 6.109e+01, 6.580e+01, 7.087e+01, 7.634e+01, 8.223e+01,
   8.857e+01, 9.541e+01, 1.028e+02, 1.107e+02, 1.192e+02, 1.284e+02, 1.383e+02,
	1.490e+02, 1.605e+02, 1.729e+02, 1.862e+02, 2.006e+02, 2.160e+02, 2.327e+02, 
	2.507e+02, 2.700e+02, 2.908e+02, 3.133e+02, 3.374e+02, 3.634e+02, 3.915e+02, 
	4.217e+02, 4.542e+02, 4.892e+02, 5.270e+02, 5.676e+02, 6.114e+02, 6.586e+02, 
	7.094e+02, 7.641e+02, 8.230e+02, 8.865e+02, 9.549e+02, 1.029e+03, 1.108e+03, 
	1.193e+03, 1.285e+03, 1.385e+03, 1.491e+03, 1.606e+03, 1.730e+03, 1.864e+03, 
	2.008e+03, 2.162e+03, 2.329e+03, 2.509e+03, 2.702e+03, 2.911e+03, 3.135e+03, 
	3.377e+03, 3.638e+03, 3.918e+03, 4.221e+03, 4.546e+03, 4.897e+03, 5.275e+03, 
	5.681e+03, 6.120e+03, 6.592e+03, 7.100e+03, 7.648e+03, 8.238e+03, 8.873e+03, 
	9.558e+03, 1.029e+04, 1.109e+04, 1.194e+04, 1.287e+04, 1.386e+04, 1.493e+04, 
	1.608e+04, 1.732e+04, 1.865e+04, 2.009e+04, 2.164e+04, 2.331e+04, 2.511e+04, 
	2.705e+04, 2.913e+04, 3.138e+04, 3.380e+04, 3.641e+04, 3.922e+04, 4.224e+04, 
	4.550e+04, 4.901e+04, 5.279e+04, 5.686e+04, 6.125e+04, 6.598e+04, 7.106e+04, 
	7.655e+04, 8.245e+04, 8.881e+04, 9.566e+04, 1.030e+05, 1.030e+05, 1.137e+05, 
	1.254e+05, 1.383e+05, 1.526e+05, 1.683e+05, 1.857e+05, 2.049e+05, 2.260e+05, 
	2.493e+05, 2.750e+05, 3.034e+05, 3.347e+05, 3.692e+05, 4.073e+05, 4.493e+05, 
	4.957e+05, 5.468e+05, 6.033e+05, 6.655e+05, 7.341e+05, 8.099e+05, 8.934e+05, 
	9.856e+05, 1.087e+06, 1.199e+06, 1.323e+06, 1.460e+06, 1.610e+06, 1.776e+06, 
	1.960e+06, 2.162e+06, 2.385e+06, 2.631e+06, 2.902e+06, 3.201e+06, 3.532e+06, 
	3.896e+06, 4.298e+06, 4.741e+06, 5.231e+06, 5.770e+06
};

float llAmp[][152] = {
	{0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00,
	 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00,
	 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00,
	 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00,
	 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00,
	 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00,
	 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00,
	 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00,
	 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00,
	 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00,
	 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00,
	 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00,
	 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00,
	 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00,
	 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00,
	 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 7.495e-17, 9.880e-17,
	 9.435e-17, 4.621e-17, 4.621e-17, 4.621e-17, 7.669e-17, 6.234e-17, 1.161e-16,
	 6.092e-17, 1.678e-16, 2.017e-16, 4.119e-16, 1.396e-16, 6.995e-17, 1.188e-16, 
	 2.425e-16, 1.530e-16, 8.806e-17, 2.017e-16, 2.064e-16, 1.840e-16, 1.757e-16,
	 3.671e-16, 2.316e-16, 4.313e-16, 1.926e-15, 4.516e-16, 8.031e-16, 1.640e-15,
	 2.849e-15, 8.605e-16, 3.933e-15, 3.587e-15, 1.428e-15, 2.916e-15, 2.316e-15,
	 1.757e-15, 3.426e-15, 4.025e-14, 2.112e-14, 1.302e-14},
	 
	{7.273e-09, 2.900e-09, 6.646e-10, 2.962e-10, 3.108e-10, 1.830e-09, 2.150e-10,
	 8.560e-11, 3.736e-10, 1.631e-10, 7.120e-11, 1.053e-12, 2.304e-12, 4.290e-11,
	 3.823e-12, 2.358e-11, 1.209e-11, 8.174e-11, 6.060e-12, 1.006e-11, 1.237e-11,
	 2.412e-11, 2.968e-12, 2.707e-12, 4.492e-13, 1.669e-12, 1.029e-11, 1.708e-12,
	 3.037e-12, 1.209e-12, 1.916e-12, 2.101e-12, 2.582e-12, 6.052e-13, 6.337e-13,
	 3.326e-13, 5.034e-13, 4.187e-13, 8.748e-13, 5.271e-13, 2.642e-13, 4.384e-13,
	 7.978e-14, 1.419e-13, 6.337e-13, 2.197e-13, 2.466e-13, 1.052e-13, 1.870e-14,
	 2.099e-14, 8.952e-14, 8.952e-14, 4.487e-14, 3.326e-14, 1.745e-14, 1.486e-13,
	 5.648e-14, 1.076e-14, 2.831e-14, 6.485e-14, 7.633e-15, 7.992e-15, 1.006e-14,
	 9.609e-15, 5.658e-15, 3.182e-15, 4.928e-15, 3.182e-15, 2.708e-15, 1.789e-15,
	 1.595e-15, 1.789e-15, 2.054e-15, 2.102e-15, 1.523e-15, 1.210e-15, 1.421e-15,
	 1.296e-15, 1.129e-15, 1.054e-15, 4.495e-15, 1.182e-15, 1.054e-15, 1.182e-15,
	 1.523e-15, 6.648e-16, 3.332e-16, 4.099e-16, 9.838e-16, 5.661e-16, 5.928e-16,
	 5.163e-16, 4.709e-16, 5.045e-16, 5.163e-16, 6.806e-16, 4.294e-16, 3.411e-16,
	 3.827e-16, 3.490e-16, 3.490e-16, 3.258e-16, 3.411e-16, 3.111e-16, 4.930e-16,
	 3.111e-16, 3.111e-16, 3.655e-16, 3.411e-16, 4.294e-16, 5.556e-17, 5.953e-17,
	 5.306e-17, 4.621e-17, 6.994e-17, 6.994e-17, 1.011e-16, 7.157e-17, 1.364e-16,
	 1.083e-16, 1.273e-16, 1.798e-16, 3.587e-16, 6.234e-17, 1.333e-16, 1.602e-16,
	 3.426e-16, 1.273e-16, 2.849e-16, 2.425e-16, 1.757e-16, 7.324e-17, 2.370e-16,
	 3.348e-16, 1.364e-16, 5.685e-16, 1.926e-15, 6.995e-16, 7.324e-16, 1.109e-15,
	 2.064e-15, 1.840e-15, 4.413e-15, 2.785e-15, 9.221e-16, 2.425e-15, 1.461e-14,
	 5.067e-15, 3.426e-15, 2.017e-14, 3.272e-14, 5.067e-14},
	 
	{7.273e-09, 2.900e-09, 6.646e-10, 2.962e-10, 3.108e-10, 1.830e-09, 2.150e-10,
	 8.560e-11, 3.736e-10, 1.631e-10, 7.120e-11, 1.053e-12, 2.304e-12, 4.290e-11,
	 3.823e-12, 2.358e-11, 1.209e-11, 8.174e-11, 6.060e-12, 1.006e-11, 1.237e-11,
	 2.412e-11, 2.968e-12, 2.707e-12, 4.492e-13, 1.669e-12, 1.029e-11, 1.708e-12,
	 3.037e-12, 1.209e-12, 1.916e-12, 2.101e-12, 2.582e-12, 6.052e-13, 6.337e-13,
	 3.326e-13, 5.034e-13, 4.187e-13, 8.748e-13, 5.271e-13, 2.642e-13, 4.384e-13,
	 7.978e-14, 1.419e-13, 6.337e-13, 2.197e-13, 2.466e-13, 1.052e-13, 1.870e-14,
	 2.099e-14, 8.952e-14, 8.952e-14, 4.487e-14, 3.326e-14, 1.745e-14, 1.486e-13,
	 5.648e-14, 1.076e-14, 2.831e-14, 6.485e-14, 7.633e-15, 7.992e-15, 1.006e-14,
	 9.609e-15, 5.658e-15, 3.182e-15, 4.928e-15, 3.182e-15, 2.708e-15, 1.789e-15,
	 1.595e-15, 1.789e-15, 2.054e-15, 2.102e-15, 1.523e-15, 1.210e-15, 1.421e-15,
	 1.296e-15, 1.129e-15, 1.054e-15, 4.495e-15, 1.182e-15, 1.054e-15, 1.182e-15,
	 1.523e-15, 6.648e-16, 3.332e-16, 4.099e-16, 9.838e-16, 5.661e-16, 5.928e-16,
	 5.163e-16, 4.709e-16, 5.045e-16, 5.163e-16, 6.806e-16, 4.294e-16, 3.411e-16,
	 3.827e-16, 3.490e-16, 3.490e-16, 3.258e-16, 3.411e-16, 3.111e-16, 4.930e-16,
	 3.111e-16, 3.111e-16, 3.655e-16, 3.411e-16, 4.294e-16, 7.495e-17, 9.880e-17,
	 6.092e-17, 3.933e-17, 3.933e-17, 4.621e-17, 8.806e-17, 7.157e-17, 1.244e-16,
	 9.880e-17, 1.396e-16, 3.756e-16, 3.426e-16, 7.324e-17, 8.031e-17, 1.602e-16,
	 2.659e-16, 1.798e-16, 2.017e-16, 2.162e-16, 1.757e-16, 8.409e-17, 3.348e-16,
	 2.425e-16, 2.599e-16, 5.429e-16, 3.506e-15, 8.409e-16, 4.952e-16, 7.157e-16,
	 1.678e-15, 1.530e-15, 4.952e-15, 2.785e-15, 6.995e-16, 4.952e-15, 1.333e-14, 
	 3.124e-15, 2.785e-15, 1.188e-14, 2.425e-14, 7.324e-15},
	
	{6.335e-08, 1.077e-08, 4.193e-10, 7.104e-10, 5.278e-11, 7.629e-10, 5.655e-11, 
	 4.390e-10, 1.669e-11, 1.748e-11, 2.834e-11, 2.834e-10, 2.412e-11, 5.655e-11, 
	 7.120e-12, 4.290e-11, 1.128e-10, 1.209e-12, 6.493e-12, 1.078e-10, 1.830e-12, 
	 9.385e-11, 5.158e-09, 8.365e-12, 4.926e-12, 2.200e-11, 6.799e-11, 7.806e-13, 
 	 8.759e-11, 5.787e-13, 2.707e-12, 2.412e-12, 9.160e-13, 1.592e-12, 3.483e-13, 
	 1.592e-13, 5.394e-13, 3.908e-13, 9.160e-14, 2.766e-13, 5.780e-13, 3.564e-13, 
	 3.819e-13, 4.919e-13, 7.446e-13, 4.384e-13, 2.897e-13, 6.791e-14, 2.147e-13, 
	 3.403e-14, 3.176e-13, 4.092e-14, 1.629e-13, 3.033e-14, 3.564e-13, 2.831e-13, 
	 1.828e-14, 1.486e-14, 1.592e-14, 7.276e-14, 8.764e-15, 5.043e-15, 1.210e-14, 
	 6.803e-15, 4.006e-15, 2.253e-15, 2.305e-15, 3.653e-15, 4.292e-15, 1.389e-15, 
	 3.489e-15, 2.470e-15, 2.771e-15, 1.670e-15, 2.102e-15, 1.030e-15, 1.632e-15, 
	 1.523e-15, 1.103e-15, 1.789e-15, 3.332e-15, 9.833e-16, 9.390e-16, 8.764e-15, 
	 1.054e-15, 9.390e-16, 5.281e-16, 9.833e-16, 5.793e-16, 3.827e-16, 5.163e-16, 
	 5.532e-16, 5.045e-16, 4.394e-16, 3.572e-16, 3.572e-16, 4.294e-16, 3.411e-16, 
	 3.827e-16, 3.490e-16, 3.490e-16, 3.258e-16, 3.411e-16, 3.111e-16, 4.930e-16, 
	 3.111e-16, 3.111e-16, 3.655e-16, 3.411e-16, 4.294e-16, 5.556e-17, 5.953e-17, 
	 4.621e-17, 3.933e-17, 5.306e-17, 6.092e-17, 1.273e-16, 8.218e-17, 1.364e-16, 
	 1.273e-16, 1.883e-16, 7.669e-16, 3.426e-16, 2.017e-16, 9.221e-17, 2.721e-16, 
	 2.017e-16, 2.017e-16, 2.263e-16, 1.798e-16, 1.883e-16, 9.655e-17, 2.263e-16, 
	 4.839e-16, 2.599e-16, 4.516e-16, 2.721e-15, 6.379e-16, 6.379e-16, 6.234e-16, 
	 1.035e-15, 9.435e-16, 2.659e-15, 1.717e-15, 8.806e-16, 1.971e-15, 1.971e-14, 
	 7.158e-15, 2.540e-15, 1.757e-14, 1.035e-14, 8.031e-15},
	 
	{6.335e-08, 1.077e-08, 4.193e-10, 7.104e-10, 5.278e-11, 7.629e-10, 5.655e-11, 
	 4.390e-10, 1.669e-11, 1.748e-11, 2.834e-11, 2.834e-10, 2.412e-11, 5.655e-11, 
	 7.120e-12, 4.290e-11, 1.128e-10, 1.209e-12, 6.493e-12, 1.078e-10, 1.830e-12, 
	 9.385e-11, 5.158e-09, 8.365e-12, 4.926e-12, 2.200e-11, 6.799e-11, 7.806e-13, 
	 8.759e-11, 5.787e-13, 2.707e-12, 2.412e-12, 9.160e-13, 1.592e-12, 3.483e-13, 
	 1.592e-13, 5.394e-13, 3.908e-13, 9.160e-14, 2.766e-13, 5.780e-13, 3.564e-13, 
	 3.819e-13, 4.919e-13, 7.446e-13, 4.384e-13, 2.897e-13, 6.791e-14, 2.147e-13, 
	 3.403e-14, 3.176e-13, 4.092e-14, 1.629e-13, 3.033e-14, 3.564e-13, 2.831e-13, 
	 1.828e-14, 1.486e-14, 1.592e-14, 7.276e-14, 8.764e-15, 5.043e-15, 1.210e-14, 
	 6.803e-15, 4.006e-15, 2.253e-15, 2.305e-15, 3.653e-15, 4.292e-15, 1.389e-15, 
	 3.489e-15, 2.470e-15, 2.771e-15, 1.670e-15, 2.102e-15, 1.030e-15, 1.632e-15, 
	 1.523e-15, 1.103e-15, 1.789e-15, 3.332e-15, 9.833e-16, 9.390e-16, 8.764e-15, 
	 1.054e-15, 9.390e-16, 5.281e-16, 9.833e-16, 5.793e-16, 3.827e-16, 5.163e-16, 
	 5.532e-16, 5.045e-16, 4.394e-16, 3.572e-16, 3.572e-16, 4.294e-16, 3.411e-16, 
	 3.827e-16, 3.490e-16, 3.490e-16, 3.258e-16, 3.411e-16, 3.111e-16, 4.930e-16, 
	 3.111e-16, 3.111e-16, 3.655e-16, 3.411e-16, 4.294e-16, 7.495e-17, 9.880e-17,
	 9.435e-17, 6.994e-17, 6.994e-17, 8.806e-17, 1.428e-16, 1.273e-16, 1.798e-16, 
	 1.678e-16, 1.678e-16, 2.263e-16, 2.263e-16, 7.324e-17, 9.221e-17, 1.602e-16, 
	 1.530e-16, 1.396e-16, 1.530e-16, 1.883e-16, 2.721e-16, 9.655e-17, 3.933e-16, 
	 5.306e-16, 3.348e-16, 4.516e-16, 2.425e-15, 8.031e-16, 4.025e-16, 6.835e-16, 
	 2.064e-15, 1.035e-15, 1.495e-15, 1.273e-15, 8.806e-16, 8.806e-16, 2.263e-14, 
	 1.109e-14, 3.756e-15, 8.605e-15, 2.263e-14, 4.516e-15},
	 
	{7.273e-09, 2.468e-08, 5.159e-09, 2.097e-10, 2.770e-10, 2.645e-09, 3.736e-12, 
	 5.655e-10, 6.799e-11, 6.060e-12, 1.103e-10, 2.304e-11, 2.358e-10, 1.708e-11, 
	 1.103e-10, 1.916e-11, 2.645e-11, 9.604e-12, 2.412e-11, 3.487e-11, 4.390e-11, 
	 8.759e-12, 1.594e-11, 9.828e-13, 6.345e-12, 9.828e-13, 1.558e-11, 4.290e-12, 
	 3.037e-12, 3.408e-12, 4.926e-13, 4.597e-12, 2.099e-12, 8.952e-13, 4.384e-13, 
	 3.326e-13, 7.619e-13, 6.636e-13, 6.636e-13, 2.766e-13, 2.642e-13, 1.958e-13, 
	 6.485e-13, 5.648e-13, 6.337e-14, 1.958e-13, 5.271e-13, 3.176e-13, 5.394e-14, 
	 2.147e-13, 3.176e-13, 8.952e-14, 2.523e-13, 1.355e-13, 1.745e-14, 8.952e-15, 
	 1.629e-13, 3.483e-14, 4.187e-14, 1.958e-14, 1.670e-14, 1.789e-14, 6.961e-15, 
	 4.495e-15, 3.489e-15, 3.653e-15, 2.305e-15, 3.182e-15, 4.928e-15, 1.523e-15, 
	 1.874e-15, 3.332e-15, 1.078e-15, 1.670e-15, 1.030e-15, 9.390e-16, 1.129e-15, 
	 2.253e-15, 1.129e-15, 1.054e-15, 2.771e-15, 9.833e-16, 9.833e-16, 4.195e-15, 
	 1.632e-15, 1.054e-15, 9.833e-16, 1.030e-15, 7.293e-16, 4.196e-16, 4.818e-16, 
	 4.497e-16, 4.101e-16, 4.101e-16, 3.572e-16, 3.827e-16, 4.294e-16, 3.411e-16, 
	 3.827e-16, 3.490e-16, 3.490e-16, 3.258e-16, 3.411e-16, 3.111e-16, 4.930e-16, 
	 3.111e-16, 3.111e-16, 3.655e-16, 3.411e-16, 4.294e-16, 5.556e-17, 5.953e-17,
	 4.621e-17, 3.933e-17, 3.933e-17, 6.092e-17, 1.428e-16, 9.435e-17, 1.364e-16, 
	 1.396e-16, 2.849e-16, 1.083e-16, 4.119e-16, 7.324e-17, 6.995e-17, 1.364e-16, 
	 2.849e-16, 1.083e-16, 1.530e-16, 1.530e-16, 1.883e-16, 9.655e-17, 2.112e-16, 
	 5.306e-16, 4.025e-16, 3.587e-16, 1.926e-15, 9.880e-16, 3.124e-16, 5.430e-16, 
	 1.273e-15, 1.396e-15, 2.659e-15, 9.655e-16, 9.655e-16, 8.409e-16, 8.031e-15, 
	 1.566e-14, 2.785e-15, 6.092e-15, 1.428e-14, 6.528e-15},
	 
	{7.273e-09, 2.468e-08, 5.159e-09, 2.097e-10, 2.770e-10, 2.645e-09, 3.736e-12, 
	 5.655e-10, 6.799e-11, 6.060e-12, 1.103e-10, 2.304e-11, 2.358e-10, 1.708e-11, 
	 1.103e-10, 1.916e-11, 2.645e-11, 9.604e-12, 2.412e-11, 3.487e-11, 4.390e-11, 
	 8.759e-12, 1.594e-11, 9.828e-13, 6.345e-12, 9.828e-13, 1.558e-11, 4.290e-12, 
	 3.037e-12, 3.408e-12, 4.926e-13, 4.597e-12, 2.099e-12, 8.952e-13, 4.384e-13, 
	 3.326e-13, 7.619e-13, 6.636e-13, 6.636e-13, 2.766e-13, 2.642e-13, 1.958e-13, 
	 6.485e-13, 5.648e-13, 6.337e-14, 1.958e-13, 5.271e-13, 3.176e-13, 5.394e-14, 
	 2.147e-13, 3.176e-13, 8.952e-14, 2.523e-13, 1.355e-13, 1.745e-14, 8.952e-15, 
	 1.629e-13, 3.483e-14, 4.187e-14, 1.958e-14, 1.670e-14, 1.789e-14, 6.961e-15, 
	 4.495e-15, 3.489e-15, 3.653e-15, 2.305e-15, 3.182e-15, 4.928e-15, 1.523e-15, 
	 1.874e-15, 3.332e-15, 1.078e-15, 1.670e-15, 1.030e-15, 9.390e-16, 1.129e-15, 
	 2.253e-15, 1.129e-15, 1.054e-15, 2.771e-15, 9.833e-16, 9.833e-16, 4.195e-15, 
	 1.632e-15, 1.054e-15, 9.833e-16, 1.030e-15, 7.293e-16, 4.196e-16, 4.818e-16, 
	 4.497e-16, 4.101e-16, 4.101e-16, 3.572e-16, 3.827e-16, 4.294e-16, 3.411e-16, 
	 3.827e-16, 3.490e-16, 3.490e-16, 3.258e-16, 3.411e-16, 3.111e-16, 4.930e-16, 
	 3.111e-16, 3.111e-16, 3.655e-16, 3.411e-16, 4.294e-16, 7.495e-17, 9.880e-17,
	 6.994e-17, 4.621e-17, 4.621e-17, 5.306e-17, 1.011e-16, 6.234e-17, 1.059e-16, 
	 1.161e-16, 2.162e-16, 2.017e-16, 4.313e-16, 1.566e-16, 8.031e-17, 1.461e-16, 
	 2.017e-16, 1.161e-16, 9.880e-17, 2.263e-16, 2.263e-16, 8.409e-17, 1.364e-16, 
	 4.025e-16, 4.025e-16, 3.053e-16, 1.302e-15, 1.083e-15, 4.215e-16, 5.685e-16, 
	 7.848e-16, 1.273e-15, 1.011e-15, 1.161e-15, 8.409e-16, 8.409e-16, 2.112e-14, 
	 1.840e-14, 1.566e-15, 8.605e-15, 1.757e-14, 1.011e-14},
	 
	{3.481e-09, 2.006e-08, 4.004e-09, 1.590e-09, 4.597e-10, 6.493e-10, 7.285e-12, 
	 1.916e-10, 1.296e-10, 4.390e-11, 5.922e-11, 4.926e-11, 1.029e-11, 3.487e-11, 
	 5.158e-11, 1.916e-11, 7.806e-12, 2.358e-11, 3.736e-11, 1.830e-11, 8.963e-13, 
	 4.704e-12, 2.645e-13, 9.828e-13, 6.493e-13, 5.787e-12, 1.748e-11, 9.172e-12, 
	 1.594e-13, 2.834e-12, 1.078e-12, 6.799e-12, 3.908e-12, 1.208e-12, 1.236e-12, 
	 1.745e-13, 5.034e-13, 1.486e-12, 5.394e-13, 4.092e-13, 4.807e-13, 1.745e-13, 
	 4.591e-13, 5.648e-13, 3.483e-13, 6.636e-13, 1.828e-13, 7.978e-14, 3.819e-14, 
	 7.276e-14, 1.294e-13, 4.591e-14, 6.337e-14, 6.052e-14, 1.127e-13, 3.326e-14, 
	 2.466e-14, 1.828e-14, 3.403e-14, 3.732e-14, 1.210e-14, 2.359e-15, 6.349e-15, 
	 4.816e-15, 5.043e-15, 3.409e-15, 4.928e-15, 2.969e-15, 3.039e-15, 2.008e-15, 
	 1.454e-15, 1.917e-15, 1.054e-15, 1.182e-15, 1.421e-15, 1.421e-15, 3.332e-15, 
	 1.030e-15, 1.103e-15, 1.210e-15, 3.915e-15, 1.030e-15, 8.968e-16, 3.332e-15, 
	 1.030e-15, 6.648e-16, 6.204e-16, 5.281e-16, 7.293e-16, 5.283e-16, 6.964e-16, 
	 8.182e-16, 7.293e-16, 5.793e-16, 4.196e-16, 3.572e-16, 4.294e-16, 3.411e-16, 
	 3.827e-16, 3.490e-16, 3.490e-16, 3.258e-16, 3.411e-16, 3.111e-16, 4.930e-16, 
	 3.111e-16, 3.111e-16, 3.655e-16, 3.411e-16, 4.294e-16, 5.556e-17, 5.953e-17,
	 6.092e-17, 4.621e-17, 3.933e-17, 6.092e-17, 1.428e-16, 9.435e-17, 1.244e-16, 
	 1.273e-16, 2.425e-16, 1.530e-16, 2.849e-16, 1.717e-16, 8.031e-17, 1.244e-16, 
	 2.162e-16, 1.798e-16, 1.161e-16, 1.396e-16, 2.064e-16, 1.495e-16, 1.602e-16, 
	 3.844e-16, 4.621e-16, 3.272e-16, 6.680e-16, 9.011e-16, 4.516e-16, 5.430e-16, 
	 6.379e-16, 9.435e-16, 7.669e-16, 1.883e-15, 8.409e-16, 1.059e-15, 9.880e-15, 
	 1.333e-14, 3.124e-15, 3.756e-15, 1.302e-14, 7.324e-15},
	 
	{3.481e-09, 2.006e-08, 4.004e-09, 1.590e-09, 4.597e-10, 6.493e-10, 7.285e-12, 
	 1.916e-10, 1.296e-10, 4.390e-11, 5.922e-11, 4.926e-11, 1.029e-11, 3.487e-11, 
	 5.158e-11, 1.916e-11, 7.806e-12, 2.358e-11, 3.736e-11, 1.830e-11, 8.963e-13, 
	 4.704e-12, 2.645e-13, 9.828e-13, 6.493e-13, 5.787e-12, 1.748e-11, 9.172e-12, 
	 1.594e-13, 2.834e-12, 1.078e-12, 6.799e-12, 3.908e-12, 1.208e-12, 1.236e-12, 
	 1.745e-13, 5.034e-13, 1.486e-12, 5.394e-13, 4.092e-13, 4.807e-13, 1.745e-13, 
	 4.591e-13, 5.648e-13, 3.483e-13, 6.636e-13, 1.828e-13, 7.978e-14, 3.819e-14, 
	 7.276e-14, 1.294e-13, 4.591e-14, 6.337e-14, 6.052e-14, 1.127e-13, 3.326e-14, 
	 2.466e-14, 1.828e-14, 3.403e-14, 3.732e-14, 1.210e-14, 2.359e-15, 6.349e-15, 
	 4.816e-15, 5.043e-15, 3.409e-15, 4.928e-15, 2.969e-15, 3.039e-15, 2.008e-15, 
	 1.454e-15, 1.917e-15, 1.054e-15, 1.182e-15, 1.421e-15, 1.421e-15, 3.332e-15, 
	 1.030e-15, 1.103e-15, 1.210e-15, 3.915e-15, 1.030e-15, 8.968e-16, 3.332e-15, 
	 1.030e-15, 6.648e-16, 6.204e-16, 5.281e-16, 7.293e-16, 5.283e-16, 6.964e-16, 
	 8.182e-16, 7.293e-16, 5.793e-16, 4.196e-16, 3.572e-16, 4.294e-16, 3.411e-16, 
	 3.827e-16, 3.490e-16, 3.490e-16, 3.258e-16, 3.411e-16, 3.111e-16, 4.930e-16, 
	 3.111e-16, 3.111e-16, 3.655e-16, 3.411e-16, 4.294e-16, 7.495e-17, 9.880e-17,
	 6.092e-17, 5.306e-17, 4.621e-17, 5.306e-17, 1.273e-16, 6.234e-17, 1.161e-16, 
	 1.396e-16, 1.530e-16, 1.530e-16, 4.516e-16, 1.495e-16, 5.953e-17, 1.109e-16, 
	 2.162e-16, 9.880e-17, 1.530e-16, 1.273e-16, 2.916e-16, 9.655e-17, 1.244e-16, 
	 3.348e-16, 3.844e-16, 4.119e-16, 6.092e-16, 8.031e-16, 4.516e-16, 7.669e-16, 
	 6.092e-16, 1.396e-15, 6.234e-16, 6.835e-16, 1.083e-15, 1.495e-15, 7.158e-15, 
	 1.109e-14, 6.994e-15, 3.053e-15, 1.602e-14, 1.640e-14},
	 
	{1.485e-08, 6.058e-08, 1.357e-08, 1.354e-09, 1.155e-09, 1.708e-09, 8.759e-11, 
	 8.560e-11, 7.629e-11, 9.385e-11, 1.296e-11, 2.053e-12, 2.101e-10, 3.823e-11, 
	 3.913e-11, 1.357e-11, 1.916e-11, 8.963e-11, 2.585e-11, 9.385e-12, 1.830e-12, 
	 5.527e-12, 5.040e-11, 6.060e-12, 3.823e-13, 3.651e-12, 7.629e-12, 6.799e-12, 
	 8.365e-13, 1.830e-12, 1.748e-11, 1.558e-11, 2.249e-12, 9.374e-13, 1.324e-12, 
	 6.636e-13, 2.355e-13, 6.636e-13, 2.964e-13, 4.384e-13, 8.748e-13, 3.250e-13, 
	 4.092e-13, 1.236e-13, 2.964e-13, 7.446e-13, 1.667e-12, 9.160e-14, 1.386e-13, 
	 4.285e-14, 5.034e-14, 7.797e-14, 9.816e-14, 1.870e-14, 4.487e-14, 3.732e-14, 
	 1.264e-13, 1.706e-14, 2.249e-14, 3.104e-14, 5.281e-15, 4.392e-15, 6.349e-15, 
	 1.054e-14, 5.658e-15, 2.253e-15, 5.658e-15, 3.182e-15, 2.102e-15, 2.008e-15, 
	 2.201e-15, 1.523e-15, 2.054e-15, 1.054e-15, 1.632e-15, 1.210e-15, 1.210e-15, 
	 1.523e-15, 8.369e-16, 1.210e-15, 5.160e-15, 1.054e-15, 4.816e-16, 1.523e-15, 
	 1.421e-15, 1.054e-15, 6.497e-16, 5.790e-16, 8.373e-16, 4.930e-16, 5.532e-16, 
	 5.163e-16, 4.709e-16, 4.394e-16, 3.572e-16, 3.827e-16, 4.294e-16, 3.411e-16, 
	 3.827e-16, 3.490e-16, 3.490e-16, 3.258e-16, 3.411e-16, 3.111e-16, 4.930e-16, 
	 3.111e-16, 3.111e-16, 3.655e-16, 3.411e-16, 4.294e-16, 5.556e-17, 5.953e-17,
	 5.306e-17, 4.621e-17, 4.621e-17, 6.994e-17, 1.428e-16, 7.157e-17, 1.059e-16, 
	 1.396e-16, 3.124e-16, 1.678e-16, 4.119e-16, 2.212e-16, 1.059e-16, 7.669e-17, 
	 1.883e-16, 1.798e-16, 1.678e-16, 1.396e-16, 1.757e-16, 1.109e-16, 1.461e-16, 
	 4.215e-16, 5.067e-16, 3.587e-16, 4.729e-16, 9.011e-16, 8.806e-16, 4.119e-16, 
	 4.839e-16, 9.435e-16, 1.109e-15, 2.316e-15, 2.112e-15, 2.916e-15, 6.379e-15, 
	 9.880e-15, 5.556e-15, 2.785e-15, 1.161e-14, 1.840e-14} 
};

const char* g_lsRandText[20] = {
"int main(int argc, char** argv)\n",
"{\n",
"	size_t shape[16] = {0};\n",
"	char sInfo[128] = {'\0'};\n",
"	\n",
"	/* Test fixed size rank 2 float arrays using the amplitudes */\n",
"	float fill = -1.0;\n",
"	float value = 0.0;\n",
"	const float* pVals;\n",
"	size_t uVals;\n",
"	int rank;\n",
"	Array* pAmp = new_Array(\"amplitudes\", etFloat, 0, &fill, RANK_2(10, 152));\n",
"	if(pAmp == NULL){\n",
"		printf(\"ERROR: Array allocation test failed\n\");\n",
"		return 100;\n",
"	}\n",
"	\n",
"	printf(\"INFO: Created array '%s'\n\", Array_info(pAmp, sInfo, 64));\n",
"	/* Make sure the shape is what I think it is */\n",
"	if(Array_shape(pAmp, shape) != 2){\n",
};

int main(int argc, char** argv)
{	
	/* Exit on errors, log info messages and above */
	das_init(argv[0], DASERR_DIS_EXIT, 0, DASLOG_INFO, NULL);
	
	ptrdiff_t shape[16] = {0};
	char sInfo[128] = {'\0'};
	
	/* Test fixed size rank 2 float arrays using the amplitudes */
	float fill = -1.0;
	float value = 0.0;
	const float* pVals; 
	size_t uVals;
	int rank;
	DasAry* pAmp = new_DasAry(
		"amplitudes", vtFloat, 0, (const ubyte*)&fill, RANK_2(10, 152),
		UNIT_E_SPECDENS
	);
	if(pAmp == NULL){ 
		printf("ERROR: Array allocation test failed\n");
		return 100;
	}

	printf("INFO: Created array '%s'\n", DasAry_toStr(pAmp, sInfo, 64));
	
	/* Make sure the shape is what I think it is */
	if(DasAry_shape(pAmp, shape) != 2){
		printf("ERROR: Test 1 (static rank) failed\n");
		return 101;
	}
	if(shape[0]!=10 || shape[1]!=152){
		printf("ERROR: Test 2 (static shape) failed\n");
		return 102;
	}
	/* Getting any value should produce fill at this point */
	value = DasAry_getFloatAt(pAmp, IDX1(9, 151));
	if(value != fill){
		printf("ERROR: Test 3 (static fill value retrival) failed\n");
		return 103;
	}
	/* Get the size of the array */
	if(DasAry_size(pAmp) != 1520){
		printf("ERROR: Test 4 (static size check) failed\n");
		return 104;
	}
	/* Get number of j indices at i = 4 */
	if(DasAry_lengthIn(pAmp, DIM0) != 10){
		printf("ERROR: Test 5 (static length in dimension 0) failed\n");
		return 105;
	}
	if(DasAry_lengthIn(pAmp, DIM1_AT(4)) != 152){
		printf("ERROR: Test 6 (static dim 1 length at dim 0 index) failed\n");
		return 106;
	}
		
		
	/* Put values for all j's at i = 1 */
	if(!DasAry_putAt(pAmp, IDX1(1,0), (const ubyte*) llAmp[1], 152)){
		printf("ERROR: Test 7 (static record set) failed\n");
		return 107;
	}
	/* Test natural boundary version of get */
	pVals = DasAry_getFloatsIn(pAmp, DIM1_AT(1), &uVals);
	/*pVals = (float*) Array_getIn(pAmp, etFloat, DIM1_AT(1), &uVals);*/
	if((pVals == NULL)||(uVals != 152)){
		printf("ERROR: Test 8 (get many from static array) failed\n");
		return 108;
	}
	if(!DasAry_putAt(pAmp, IDX1(0,0), (const ubyte*)pVals, uVals)){
		printf("ERROR: Test 9 (static array record duplication) failed\n");
		return 109;
	}
	/* More subset testing */
	pVals = DasAry_getFloatsIn(pAmp, DIM0, &uVals);
	if((pVals == NULL)||(uVals != 1520)||(pVals[152] <  7.272e-09)){
		printf("ERROR: Test 10 (static array get all flat) failed\n");
		return 110;
	}
	pVals = DasAry_getFloatsIn(pAmp, DIM2_AT(0,0), &uVals);
	if((pVals == NULL)||(uVals != 1)||(*pVals < 7.272e-09)){
		printf("ERROR: Test 11 (static array get all flat - single value) failed\n");
		return 111;
	}
	
	/* Get the last value in the array */
	value = DasAry_getFloatAt(pAmp, IDX1(-1,-1));
	if(value != fill){
		printf("ERROR: Test 12 (negative index usage) failed\n");
		return 112;
	}
	
	/* Append testing, put in too few values, then qube the record */
	DasAry_append(pAmp, (const ubyte*) llAmp[0], 140);
	if( 140 != DasAry_lengthIn(pAmp, DIM1_AT(10)) ){
		printf("ERROR: Test 13 (partial record append) failed\n");
		return 113;
	}
	DasAry_qubeIn(pAmp, DIM1);
	if( 152 != DasAry_lengthIn(pAmp, DIM1_AT(10)) ){
		printf("ERROR: Test 14 (qube record) failed\n");
		return 114;
	}
	
	DasAry_clear(pAmp);
	if( ((rank = DasAry_shape(pAmp, shape)) != 2) ||
		 (shape[0] != 0) || (shape[1] != 152) || (DasAry_size(pAmp) != 0)){
		printf("ERROR: Test 15 (clear array) failed\n");
		return 115;
	}
	dec_DasAry(pAmp); pAmp = NULL;

	/* Higher dimension test, should result in 5 records in dim0 */
	pAmp = new_DasAry(
		"hirank", vtFloat, 0, (const ubyte*) &fill,
		RANK_6(0, 2, 19, 2, 2, 2), UNIT_DIMENSIONLESS
	);
	printf("INFO: Created array '%s'\n", DasAry_toStr(pAmp, sInfo, 128));
	if(!DasAry_append(pAmp, (const ubyte*) llAmp, 1520)){
		printf("ERROR: Test 16 (high-dimensional append) failed\n");
		return 116;
	}
	
	value = DasAry_getFloatAt(pAmp, IDX5(-1,-1,-1,-1,-1,-2));
	if((value < 1.160e-14)||(value > 1.162e-14)){
		printf("ERROR: Test 17 (high-dimensional read) failed\n");
		return 117;
	}
	if( ((rank = DasAry_shape(pAmp, shape)) != 6) || (shape[0] != 5) ||
		 (shape[1] != 2) || (shape[2] != 19) || (shape[3] != 2) || 
		 (shape[4] != 2) || (shape[5] != 2) ){
		printf("ERROR: Test 18 (high-dimensional post-append shape) failed\n");
		return 118;
	}
	
	/* Test getting Rank 3 subset of a rank 6 array */
	DasAry* pTmp = DasAry_subSetIn(pAmp, "lorank", DIM3_AT(4,1,18));
	char sInfo2[128] = {'\0'};
	printf("INFO: Aquired subset '%s' from '%s' at partial index (4,1,18)\n",
			 DasAry_toStr(pTmp, sInfo2, 128), DasAry_toStr(pAmp, sInfo, 128));
	
	if(pTmp == NULL){
		printf("ERROR: Test 19 (construct rank-3 subset of rank-6) failed\n");
		return 119;
	}
	if( ((rank = DasAry_shape(pTmp, shape)) != 3) || (shape[0] != 2) ||
		 (DasAry_size(pTmp) != 8)){
		printf("ERROR: Test 20 (shape of rank-3 subset of rank-6) failed\n");
		return 120;
	}
	
	/* Test and memory preallocation using the frequency array,
	 * append is faster, but let's loop just to test out the putAt() function */
	DasAry* pFreq = new_DasAry(
		"frequencies", vtDouble, 0, (const ubyte*) NULL, 
		RANK_1(152), UNIT_HERTZ
	);
	
	printf("INFO: Created array '%s'\n", DasAry_toStr(pFreq, sInfo, 128));
	
	for(int i = 0; i < 152; i++) 
		DasAry_putAt(pFreq, IDX0(i), (const ubyte*) (lFreq +i), 1);
		
	if(! das_within( DasAry_getDoubleAt(pFreq, IDX0(150)), 5.231e+06, 1e-4) ){
		printf("ERROR: Test 21 (rank 1 double array get) failed\n");
		return 121;
	}
	
	
	das_time dt;
	DasAry* pTime = new_DasAry(
		"starts", vtTime, 0, (const ubyte*)NULL, RANK_1(0), UNIT_UTC
	);
	printf("INFO: Created array '%s'\n", DasAry_toStr(pTime, sInfo, 128));
	for(int i = 0; i < 10; ++i){
		dt_parsetime(lTime[i], &dt);
		DasAry_append(pTime, (const ubyte*)&dt, 1);
	}
	dt = DasAry_getTimeAt(pTime, IDX0(5));
	dt_isoc(sInfo, 127, &dt, 3);
	if(strcmp("1997-05-07T15:01:49.541", sInfo) != 0){
		printf("ERROR: Test 22 (time array retrieval) failed\n");
		return 122;
	}
	
	/* Fully ragged array test, saving UTF-8 text */
	int iPg = 0, nLine = 0, lLinesPerPg[4] = {4,7,3,6};
	DasAry* pBytes = new_DasAry("text", vtUByte, 0, NULL, RANK_3(0,0,0), UNIT_DIMENSIONLESS);
	
	/* Das2 arrays can store cooperative flags, these do not change the
	 * array API but do flag how the array should be used.  Here we are saying
	 * to any customer of this array that we have stored values such that each
	 * run of the last index can be used as a null terminated string of bytes
	 * and that fastest moving index is probably useless. (True for UTF-8
	 * data) */
	DasAry_setUsage(pBytes, D2ARY_AS_STRING);

	printf("INFO: Created array '%s'\n", DasAry_toStr(pBytes, sInfo, 128));
	
	for(int i = 0; i < 20; ++i){
		/* Save the null bytes in the array so that strlen etc. works */
		DasAry_append(pBytes, (const ubyte*)g_lsRandText[i], strlen(g_lsRandText[i]) + 1);
		++nLine;
		if(nLine == lLinesPerPg[iPg]){  
			DasAry_markEnd(pBytes, DIM1); /* State that array of lines is full */
			++iPg; nLine = 0;             /* Must start new page */
		}
		else{ 
			DasAry_markEnd(pBytes, DIM2); /* State that char array is done */
			                              /* Must start new line */
		}
	}
	size_t uStrLen;
	const ubyte* pLine = DasAry_getBytesIn(pBytes, DIM2_AT(-1,-2), &uStrLen);
	if(strcmp("	/* Make sure the shape is what I think it is */\n", 
			    (const char*)pLine) != 0){
		printf("ERROR: Test 23 (Ragged read) failed\n");
		return 123;
	}
	
	dec_DasAry(pBytes);
	
	/* Clean up the arrays, check that all memory is free'ed using valgrind */
	dec_DasAry(pTmp);  /* do this first to test that sub arrays don't free 
							  * memory owned by parent arrays */
	dec_DasAry(pAmp);
	
	dec_DasAry(pFreq);
	dec_DasAry(pTime);
	
	printf("INFO: All array operation tests passed\n\n");
	return 0;
}
